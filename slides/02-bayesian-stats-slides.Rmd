---
title: "Bayesianische Statistik"
session: 3
subtitle: "Teil 2<br/>Parametersch채tzung"
author: "Andrew Ellis"
institute: "Kognitive Psychologie, Wahrnehmung und Methodenlehre, Universit채t Bern"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css", "custom.css", "footer.css"]
    nature:
      # slideNumberFormat: "%current%"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
      highlightStyle: github
      highlightLines: true
      ratio: 16:10
      countIncrementalSlides: true
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(include = TRUE,
                      fig.width=9, fig.height=3.5, fig.retina=3,
                      out.width = "100%",
                      cache = TRUE,
                      echo = TRUE,
                      message = FALSE, 
                      warning = FALSE,
                      fig.show = TRUE,
                      hiline = TRUE)
options(htmltools.dir.version = FALSE)

library(tidyverse)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#4C566B",
  secondary_color = "#C16069",
  inverse_header_color = "#FFFFFF"
)

xaringanExtra::use_tile_view()
xaringanExtra::use_panelset()
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
```

layout: true
.footer[[`r fontawesome::fa(name = "home", fill = "black")`](https://kogpsy.github.io/neuroscicomplab)]

---

## Letzte Sitzung:

### Bayes' Theorem


$$P(\theta|Data) = \frac{ P(Data|\theta) * P(\theta) } {P(Data)}$$
oder ohne Normalisierungskonstante: 

$$P(\theta|Data) \propto P(Data|\theta) * P(\theta)$$

--

### Binomial Likelihood

$$P(x = k) = {n \choose k} \theta^k (1-\theta)^{n-k} $$


---

## Parametersch채tzung: Parameter einer Binomialverteilung



.panelset[
.panel[.panel-name[Daten]

```{r}
wins <- 6
games <- 9
```
]

.panel[.panel-name[Maximum Likelihood Sch채tzung]

```{r}
theta <- wins/games
theta
```
]

.panel[.panel-name[Plot]

```{r echo=FALSE}
tibble(x = seq(from = 0, to = 1, by = .01)) %>% 
  mutate(density = dbinom(6, 9, x)) %>% 
  
  ggplot(aes(x = x, ymin = 0, ymax = density)) +
  geom_ribbon(size = 0, alpha = 1/4, fill = "steelblue") +
  geom_vline(xintercept = theta, linetype = 2, size = 1.2) +
  scale_y_continuous(NULL, breaks = NULL) +
  coord_cartesian(xlim = c(0, 1)) +
  xlab("Wahrscheinlichkeit") +
  theme(panel.grid = element_blank(),
        legend.position = "none")
```
]
]

---

## Posterior durch Grid Approximation

.panelset[

.panel[.panel-name[Grid]
```{r}
n_points <- 100
theta_grid <- seq(from = 0 , to = 1 , length.out = n_points)
```
]

.panel[.panel-name[Likelihood]
```{r}
likelihood <- dbinom(wins , size = games , prob = theta_grid)

```
]

.panel[.panel-name[Prior]
```{r}
prior <- dbeta(x = theta_grid, shape1 = 4,  shape2 = 4)

```
]

]


---
## Posterior durch Grid Approximation


.panelset[

.panel[.panel-name[Posterior]
```{r}
{{unstandardized_posterior <- likelihood * prior}}
posterior <- unstandardized_posterior / sum(unstandardized_posterior)
```
]

.panel[.panel-name[Plot (code)]
```{r echo=TRUE, eval=FALSE}
df <- tibble(theta_grid, prior, likelihood, posterior)

df %>%
  pivot_longer(-theta_grid, names_to = "distribution", values_to = "density") %>% 
  mutate(distribution = as_factor(distribution)) %>% 
  ggplot(aes(theta_grid, density, color = distribution)) +
  geom_line(size = 1.5) +
  geom_vline(xintercept = 9/10, linetype = "dashed") +
  scale_color_viridis_d(end = 0.8) +
  xlab("Theta Werte") +
  ylab("") +
  facet_wrap(~distribution, scales = "free_y") +
  theme_bw() +
  theme(legend.position = "none")
```
]

.panel[.panel-name[Plot]
```{r echo=FALSE}
d <- tibble(theta_grid, prior, likelihood, posterior)

d %>%
  pivot_longer(-theta_grid, names_to = "distribution", values_to = "density") %>% 
  mutate(distribution = as_factor(distribution)) %>% 
  ggplot(aes(theta_grid, density, color = distribution)) +
  geom_line(size = 1.5) +
  geom_vline(xintercept = 9/10, linetype = "dashed") +
  scale_color_viridis_d(end = 0.8) +
  xlab("Theta Werte") +
  ylab("") +
  facet_wrap(~distribution, scales = "free_y") +
  theme_bw() +
  theme(legend.position = "none")
```
]

]

---
## Posterior zusammenfassen

Samples aus dem Posterior
```{r}

n_samples <- 1e2

set.seed(3) # wegen reproduzierbarkeit

samples <-
  d %>% 
  slice_sample(n = n_samples, weight_by = posterior, replace = TRUE)

glimpse(samples)
```


---

# Graphical model


.pull-left[
![an image](images/binomial-graphical-model.png)]

--

.pull-right[
![an image](images/bernoulli-graphical-model.png)]

---
